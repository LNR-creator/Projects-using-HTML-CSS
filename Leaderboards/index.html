<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>LeetCode Leaderboard</title>
<style>
    body {
        background-color: #0f172a;
        color: white;
        font-family: Arial, sans-serif;
        padding: 20px;
    }
    h1 {
        text-align: center;
        margin-bottom: 20px;
    }
    .controls {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin-bottom: 20px;
    }
    input {
        padding: 10px;
        border-radius: 6px;
        border: 2px solid #f97316;
        outline: none;
    }
    button {
        padding: 10px 15px;
        background-color: #06b6d4;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
    }
    button:hover {
        background-color: #0891b2;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
    }
    th, td {
        padding: 12px;
        text-align: center;
    }
    th {
        background-color: #1e293b;
    }
    tr {
        transition: transform 0.5s ease, background-color 0.5s ease;
    }
    .rank-1 { background-color: #ffd70033; }
    .rank-2 { background-color: #c0c0c033; }
    .rank-3 { background-color: #cd7f3233; }
    a {
        color: #38bdf8;
        text-decoration: none;
    }
    a:hover {
        text-decoration: underline;
    }
</style>
</head>
<body>
<h1>LeetCode Leaderboard</h1>
<div class="controls">
    <input type="text" id="username" placeholder="LeetCode Username">
    <button onclick="addUser()">Add User</button>
    <button onclick="refreshData()">Refresh Now</button>
</div>

<table>
    <thead>
        <tr>
            <th>Rank</th>
            <th>Username</th>
            <th>Total</th>
            <th>Easy</th>
            <th>Medium</th>
            <th>Hard</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody id="leaderboard"></tbody>
</table>

<script>
    let users = JSON.parse(localStorage.getItem("leetcodeUsers")) || [];

    async function fetchUserData(username) {
        const res = await fetch(`/api/leetcode?username=${username}`);
        return res.json();
    }

    async function refreshData() {
        const data = [];
        for (let username of users) {
            const userData = await fetchUserData(username);
            if (userData.status === "success") data.push(userData);
        }
        data.sort((a, b) => b.totalSolved - a.totalSolved);
        renderTable(data);
    }

    function renderTable(data) {
        const tbody = document.getElementById("leaderboard");
        tbody.innerHTML = "";
        data.forEach((u, index) => {
            const tr = document.createElement("tr");
            if (index === 0) tr.classList.add("rank-1");
            else if (index === 1) tr.classList.add("rank-2");
            else if (index === 2) tr.classList.add("rank-3");

            tr.innerHTML = `
                <td>${index + 1}</td>
                <td><a href="https://leetcode.com/${u.username}/" target="_blank">${u.username}</a></td>
                <td>${u.totalSolved}</td>
                <td>${u.easySolved}</td>
                <td>${u.mediumSolved}</td>
                <td>${u.hardSolved}</td>
                <td><button onclick="deleteUser('${u.username}')">Delete</button></td>
            `;
            tbody.appendChild(tr);
        });
    }

    function addUser() {
        const username = document.getElementById("username").value.trim();
        if (username && !users.includes(username)) {
            users.push(username);
            localStorage.setItem("leetcodeUsers", JSON.stringify(users));
            refreshData();
        }
        document.getElementById("username").value = "";
    }

    function deleteUser(username) {
        users = users.filter(u => u !== username);
        localStorage.setItem("leetcodeUsers", JSON.stringify(users));
        refreshData();
    }

    refreshData();
    setInterval(refreshData, 60000); // auto refresh every minute
</script>
</body>
</html>
